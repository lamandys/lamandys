---
title: æ‰‹å†™ä¸€ä¸ªæƒé™ç”³è¯·åº“
date: 2020-01-20 18:32:55
tags: [Android]
---

ç½‘ä¸Šçš„æƒé™ç”³è¯·åº“é‚£ä¹ˆå¤šï¼Œä½ ä¸ºä»€ä¹ˆè¦è‡ªå·±å†™ä¸€ä¸ªï¼Ÿçš„ç¡®ï¼Œç½‘ä¸Šå¼€æºåº“åƒåƒä¸‡ï¼Œç”¨èµ·æ¥ä¹Ÿå¾ˆæ–¹ä¾¿ã€‚å¯æ˜¯é‚£éƒ½æ˜¯äººå®¶çš„ï¼Œä½ ç¡®å®šä½ è‡ªå·±ä¸å†™ä¸€ä¸‹ï¼Ÿå¾ˆç®€å•ï¼Œæˆ‘æƒ³ç»§ç»­é€ è½®å­ï¼Œä¸ç„¶æˆ‘ä¸æ‡‚æ€ä¹ˆç©ğŸ˜

<!-- more -->

<img src="../æ‰‹å†™ä¸€ä¸ªæƒé™ç”³è¯·åº“/1.jpg" width = "800" height = "534" alt="ä¸æ–‡æ— å…³" align=center />

#### åŠ¨æ‰‹ è¦å†™è‚¯å®šè¦å†™ä¸€ä¸ªå¯ä»¥å¾ˆç®€å•çš„ä½¿ç”¨çš„åº“å•¦
1. å…¥å£
a. å‚æ•°è®¾è®¡å°±æ˜¯ç¬¬ä¸€ä¸ªä¸Šä¸‹æ–‡ï¼Œè‡³äºä¸ºä»€ä¹ˆè¦ç”¨FragmentActivityï¼Œä¸‹é¢æ­æ™“
b. ç¬¬äºŒä¸ªæ˜¯ä¼ é€’ä¸€ä¸ªListè¿‡å»ï¼Œè®©æ¥å…¥æ–¹æŠŠéœ€è¦çš„æƒé™æ·»åŠ å³å¯ã€‚
c. æœ€åä¸€ä¸ªå°±æ˜¯callbackï¼Œè¯·æ±‚è¿‡ç¨‹ä¸­çš„å›è°ƒ
```
public static void request(FragmentActivity activity, Consumer<ArrayList<String>> consumer, PermissionCallback callback) {
        PermissionDelegateFragment delegateFragment = PermissionDelegateFinder.getInstance().find(activity);
        ArrayList<String> perms = new ArrayList<>();
        consumer.accept(perms);
        delegateFragment.request(perms.toArray(new String[]{}), callback);
    }
```
2. æœ‰äº†å…¥å£ï¼Œå°±æ˜¯è¿›è¡Œè¯·æ±‚æƒé™äº†
 ä¸æ€¥ï¼Œä¸Šé¢æåˆ°çš„ä¸ºä»€ä¹ˆè¦ç”¨FragmentActivityå‘¢ï¼Ÿçœ‹ä»£ç ï¼š
```
PermissionDelegateFragment delegateFragment = PermissionDelegateFinder.getInstance().find(activity);
```
	activityåœ¨è¿™ä¸€è¡Œæœ‰ç”¨åˆ°ï¼Œå…·ä½“æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿç»§ç»­å¾€ä¸‹çœ‹çœ‹ã€‚
3. å¯»æ‰¾ä»£ç†è¯·æ±‚å¯¹è±¡
```
 public PermissionDelegateFragment find(FragmentActivity fragmentActivity) {
        PermissionDelegateFragment permissionDelegateFragment = null;
        if (!fragmentActivity.isFinishing()) {
            permissionDelegateFragment = findByFragmentManager(fragmentActivity.getSupportFragmentManager());
        }
        return permissionDelegateFragment;
    }
```
	å™¢ï¼ŒåŸæ¥activityçš„ä½œç”¨æ˜¯å…³è”ä»£ç†è¯·æ±‚å¯¹è±¡çš„ã€‚
```
private PermissionDelegateFragment findByFragmentManager(final FragmentManager manager) {
        Fragment fragment = manager.findFragmentByTag(PERMISSION_TAG);
        if (fragment == null) {
            fragment = new PermissionDelegateFragment();
            manager.beginTransaction().add(fragment, PERMISSION_TAG).commitAllowingStateLoss();
        }
        return (PermissionDelegateFragment) fragment;
    }
```	
	å¦‚æœè¯¥activityæ²¡æœ‰è¯·æ±‚è¿‡æƒé™ï¼Œæ˜¯ä¸ä¼šæœ‰ä»£ç†å¯¹è±¡çš„ã€‚å½“ç¬¬ä¸€æ¬¡è¿›è¡Œè¯·æ±‚çš„æ—¶å€™ï¼Œåˆ›å»ºä»£ç†å¯¹è±¡ï¼Œå¹¶æ·»åŠ åˆ°activityä¸­è¿›è¡Œç®¡ç†ã€‚çªç„¶æ˜ç™½äº†ã€‚
4. æ‰¾åˆ°ä»£ç†å¯¹è±¡ï¼Œè¿›è¡Œè¯·æ±‚
```

```